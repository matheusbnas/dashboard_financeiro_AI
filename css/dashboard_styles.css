/* ==============================================
   DASHBOARD FINANCEIRO - ESTILOS OTIMIZADOS V2
   Compatibilidade TOTAL com temas claro e escuro
   ============================================== */

/* ============= VARIÁVEIS DE CORES INTELIGENTES ============= */
:root {
  /* Cores adaptáveis - modo claro */
  --bg-primary: #ffffff;
  --bg-secondary: #f8f9fa;
  --bg-tertiary: #e9ecef;
  --text-primary: #212529;
  --text-secondary: #6c757d;
  --text-muted: #868e96;
  
  /* Cores de interface */
  --border-color: #dee2e6;
  --shadow-color: rgba(0, 0, 0, 0.1);
  --shadow-hover: rgba(0, 0, 0, 0.15);
  
  /* Cores funcionais (sempre visíveis) */
  --accent-blue: #0066cc;
  --accent-green: #28a745;
  --accent-red: #dc3545;
  --accent-orange: #fd7e14;
  --accent-purple: #6f42c1;
  --accent-nubank: #8b2fff;
  
  /* Gradientes adaptativos */
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-success: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  --gradient-danger: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
  --gradient-nubank: linear-gradient(135deg, #8b2fff 0%, #a855f7 100%);
  
  /* Transparências para sobreposições */
  --overlay-light: rgba(255, 255, 255, 0.9);
  --overlay-dark: rgba(0, 0, 0, 0.8);
  
  /* Transições */
  --transition-fast: all 0.2s ease;
  --transition-normal: all 0.3s ease;
  --border-radius: 12px;
}

/* ============= DETECÇÃO AUTOMÁTICA DE TEMA ESCURO ============= */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-tertiary: #21262d;
    --text-primary: #f0f6fc;
    --text-secondary: #8b949e;
    --text-muted: #656d76;
    
    --border-color: #30363d;
    --shadow-color: rgba(0, 0, 0, 0.3);
    --shadow-hover: rgba(0, 0, 0, 0.5);
    
    /* Cores funcionais ajustadas para escuro */
    --accent-blue: #58a6ff;
    --accent-green: #3fb950;
    --accent-red: #f85149;
    --accent-orange: #ff8c42;
    --accent-purple: #a5a4ff;
    --accent-nubank: #b794f6;
    
    --overlay-light: rgba(13, 17, 23, 0.9);
    --overlay-dark: rgba(240, 246, 252, 0.1);
  }
}

/* Forçar tema escuro quando detectado pelo Streamlit */
[data-theme="dark"], 
.stApp[data-theme="dark"],
html[data-theme="dark"] {
  --bg-primary: #0d1117 !important;
  --bg-secondary: #161b22 !important;
  --bg-tertiary: #21262d !important;
  --text-primary: #f0f6fc !important;
  --text-secondary: #8b949e !important;
  --text-muted: #656d76 !important;
  --border-color: #30363d !important;
}

/* ============= BASE RESET E APLICAÇÃO ============= */
* {
  box-sizing: border-box;
}

.stApp {
  background-color: var(--bg-primary) !important;
  color: var(--text-primary) !important;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif !important;
  transition: var(--transition-normal) !important;
}

/* Garantir que TODOS os textos sejam legíveis */
body, div, p, span, h1, h2, h3, h4, h5, h6, 
label, button, input, textarea, select,
.stMarkdown, .stMarkdown *, 
.stText, .stText *,
[data-testid] * {
  color: var(--text-primary) !important;
  transition: var(--transition-fast) !important;
}

/* Textos secundários */
.text-secondary,
.stMarkdown .text-secondary,
small, .small {
  color: var(--text-secondary) !important;
}

/* Textos silenciados */
.text-muted,
.stMarkdown .text-muted {
  color: var(--text-muted) !important;
}

/* ============= HEADER PRINCIPAL ============= */
.main-header {
  background: var(--gradient-primary) !important;
  padding: 2.5rem 2rem !important;
  border-radius: var(--border-radius) !important;
  color: white !important;
  margin-bottom: 2rem !important;
  text-align: center !important;
  box-shadow: 0 8px 32px var(--shadow-color) !important;
  border: 1px solid var(--border-color) !important;
  transition: var(--transition-normal) !important;
}

.main-header:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 12px 40px var(--shadow-hover) !important;
}

.main-header h1, .main-header p {
  color: white !important;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
}

/* ============= SIDEBAR MELHORADO ============= */
.stSidebar {
  background-color: var(--bg-secondary) !important;
  border-right: 2px solid var(--border-color) !important;
  box-shadow: 4px 0 12px var(--shadow-color) !important;
}

.stSidebar .stMarkdown,
.stSidebar .stMarkdown *,
.stSidebar label,
.stSidebar [data-testid] * {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

/* Menu de navegação no sidebar */
.nav-menu {
  background: var(--bg-tertiary) !important;
  border-radius: var(--border-radius) !important;
  padding: 1rem !important;
  margin: 1rem 0 !important;
  border: 1px solid var(--border-color) !important;
}

.nav-menu h3 {
  color: var(--text-primary) !important;
  margin-bottom: 0.5rem !important;
  font-size: 1.1rem !important;
  font-weight: 600 !important;
}

.nav-button {
  display: block !important;
  width: 100% !important;
  padding: 0.75rem 1rem !important;
  margin: 0.25rem 0 !important;
  background: var(--bg-primary) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 8px !important;
  text-decoration: none !important;
  transition: var(--transition-fast) !important;
  cursor: pointer !important;
}

.nav-button:hover {
  background: var(--accent-blue) !important;
  color: white !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px var(--shadow-hover) !important;
}

.nav-button.active {
  background: var(--gradient-primary) !important;
  color: white !important;
  border-color: transparent !important;
}

/* ============= CARDS E MÉTRICAS LEGÍVEIS ============= */
[data-testid="metric-container"] {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--border-color) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.5rem !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
  transition: var(--transition-normal) !important;
}

[data-testid="metric-container"]:hover {
  border-color: var(--accent-blue) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 30px var(--shadow-hover) !important;
}

/* Labels das métricas */
[data-testid="metric-container"] label,
.stMetric > label {
  color: var(--text-secondary) !important;
  font-weight: 600 !important;
  font-size: 0.9rem !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px !important;
  background-color: transparent !important;
}

/* Valores das métricas */
[data-testid="metric-value"],
.stMetric [data-testid="metric-value"] {
  color: var(--text-primary) !important;
  font-size: 2rem !important;
  font-weight: 700 !important;
  background-color: transparent !important;
}

/* Deltas das métricas */
[data-testid="metric-delta"],
.stMetric [data-testid="metric-delta"] {
  font-weight: 600 !important;
  background-color: transparent !important;
}

/* ============= ALERTAS COM CONTRASTE PERFEITO ============= */
.stSuccess, .success-box {
  background: linear-gradient(135deg, var(--accent-green), rgba(40, 167, 69, 0.1)) !important;
  border: 2px solid var(--accent-green) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.2rem !important;
  margin: 1rem 0 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

.stWarning, .warning-box {
  background: linear-gradient(135deg, var(--accent-orange), rgba(253, 126, 20, 0.1)) !important;
  border: 2px solid var(--accent-orange) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.2rem !important;
  margin: 1rem 0 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

.stInfo, .info-box {
  background: linear-gradient(135deg, var(--accent-blue), rgba(0, 102, 204, 0.1)) !important;
  border: 2px solid var(--accent-blue) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.2rem !important;
  margin: 1rem 0 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

.stError, .error-box {
  background: linear-gradient(135deg, var(--accent-red), rgba(220, 53, 69, 0.1)) !important;
  border: 2px solid var(--accent-red) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.2rem !important;
  margin: 1rem 0 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

/* Textos dentro de alertas sempre legíveis */
.stSuccess *, .stWarning *, .stInfo *, .stError *,
.success-box *, .warning-box *, .info-box *, .error-box * {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

/* ============= TABS MELHORADAS ============= */
.stTabs [data-baseweb="tab-list"] {
  gap: 8px !important;
  background: var(--bg-secondary) !important;
  border-radius: var(--border-radius) !important;
  padding: 0.5rem !important;
  border: 1px solid var(--border-color) !important;
}

.stTabs [data-baseweb="tab"] {
  border-radius: 8px !important;
  padding: 0.8rem 1.5rem !important;
  font-weight: 600 !important;
  transition: var(--transition-fast) !important;
  border: 1px solid transparent !important;
  background: transparent !important;
  color: var(--text-secondary) !important;
}

.stTabs [data-baseweb="tab"]:hover {
  background: var(--accent-blue) !important;
  color: white !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px var(--shadow-hover) !important;
}

.stTabs [aria-selected="true"] {
  background: var(--gradient-primary) !important;
  color: white !important;
  border-color: transparent !important;
  box-shadow: 0 4px 16px var(--shadow-color) !important;
}

/* ============= TABELAS LEGÍVEIS ============= */
.stDataFrame {
  border: none !important;
  border-radius: var(--border-radius) !important;
  overflow: hidden !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
  background: var(--bg-primary) !important;
}

.stDataFrame table {
  background: var(--bg-primary) !important;
  color: var(--text-primary) !important;
  width: 100% !important;
}

.stDataFrame thead th {
  background: var(--gradient-primary) !important;
  color: white !important;
  font-weight: 700 !important;
  padding: 1rem !important;
  text-align: left !important;
  border: none !important;
}

.stDataFrame tbody td {
  padding: 0.8rem 1rem !important;
  border-bottom: 1px solid var(--border-color) !important;
  color: var(--text-primary) !important;
  background: var(--bg-primary) !important;
}

.stDataFrame tbody tr:hover {
  background: var(--bg-secondary) !important;
}

.stDataFrame tbody tr:nth-child(even) {
  background: var(--bg-secondary) !important;
}

.stDataFrame tbody tr:nth-child(even):hover {
  background: var(--bg-tertiary) !important;
}

/* ============= BOTÕES SEMPRE VISÍVEIS ============= */
.stButton > button {
  background: var(--gradient-primary) !important;
  color: white !important;
  border: none !important;
  border-radius: var(--border-radius) !important;
  padding: 0.8rem 2rem !important;
  font-weight: 600 !important;
  font-size: 1rem !important;
  transition: var(--transition-normal) !important;
  box-shadow: 0 4px 16px var(--shadow-color) !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px !important;
  cursor: pointer !important;
}

.stButton > button:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 24px var(--shadow-hover) !important;
  filter: brightness(110%) !important;
}

.stButton > button:active {
  transform: translateY(0) !important;
}

/* Botões específicos */
.stDownloadButton > button {
  background: var(--gradient-success) !important;
  color: white !important;
}

.google-sheets-button {
  background: var(--gradient-success) !important;
  color: white !important;
  border: none !important;
  border-radius: var(--border-radius) !important;
  padding: 1rem 2rem !important;
  font-weight: 600 !important;
  font-size: 1.1rem !important;
  transition: var(--transition-normal) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
  cursor: pointer !important;
  display: flex !important;
  align-items: center !important;
  gap: 0.5rem !important;
}

/* ============= INPUTS LEGÍVEIS ============= */
.stTextInput > div > div > input,
.stSelectbox > div > div > div,
.stMultiSelect > div > div > div,
.stNumberInput > div > div > input,
.stDateInput > div > div > input {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--border-color) !important;
  border-radius: 8px !important;
  color: var(--text-primary) !important;
  padding: 0.8rem !important;
  transition: var(--transition-fast) !important;
}

.stTextInput > div > div > input:focus,
.stSelectbox > div > div > div:focus,
.stMultiSelect > div > div > div:focus,
.stNumberInput > div > div > input:focus,
.stDateInput > div > div > input:focus {
  border-color: var(--accent-blue) !important;
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2) !important;
  background: var(--bg-primary) !important;
}

/* Labels dos inputs */
.stTextInput > label,
.stSelectbox > label,
.stMultiSelect > label,
.stNumberInput > label,
.stDateInput > label {
  color: var(--text-primary) !important;
  font-weight: 600 !important;
  margin-bottom: 0.5rem !important;
}

/* ============= GRÁFICOS INTEGRADOS ============= */
.js-plotly-plot {
  border-radius: var(--border-radius) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
  overflow: hidden !important;
  background: var(--bg-primary) !important;
  border: 1px solid var(--border-color) !important;
}

/* ============= EXPANSORES LEGÍVEIS ============= */
.streamlit-expanderHeader {
  background: var(--bg-secondary) !important;
  border-radius: var(--border-radius) !important;
  border: 2px solid var(--border-color) !important;
  color: var(--text-primary) !important;
  font-weight: 600 !important;
  transition: var(--transition-fast) !important;
  padding: 1rem !important;
}

.streamlit-expanderHeader:hover {
  border-color: var(--accent-blue) !important;
  background: var(--accent-blue) !important;
  color: white !important;
}

.streamlit-expanderContent {
  background: var(--bg-primary) !important;
  border: 2px solid var(--border-color) !important;
  border-top: none !important;
  border-radius: 0 0 var(--border-radius) var(--border-radius) !important;
  padding: 1.5rem !important;
  color: var(--text-primary) !important;
}

/* ============= CHATBOT ESPECÍFICO ============= */
.chat-container {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--border-color) !important;
  border-radius: var(--border-radius) !important;
  padding: 1rem !important;
  margin: 1rem 0 !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

.chat-message {
  background: var(--bg-primary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 8px !important;
  padding: 1rem !important;
  margin: 0.5rem 0 !important;
  color: var(--text-primary) !important;
}

.chat-message.user {
  background: var(--accent-blue) !important;
  color: white !important;
  margin-left: 2rem !important;
}

.chat-message.assistant {
  background: var(--bg-secondary) !important;
  color: var(--text-primary) !important;
  margin-right: 2rem !important;
}

.chat-input {
  background: var(--bg-primary) !important;
  border: 2px solid var(--border-color) !important;
  border-radius: 8px !important;
  color: var(--text-primary) !important;
  padding: 0.8rem !important;
  width: 100% !important;
}

/* ============= NUBANK ESPECÍFICO ============= */
.nubank-mode-indicator {
  background: linear-gradient(135deg, var(--accent-nubank), rgba(139, 47, 255, 0.1)) !important;
  border: 2px solid var(--accent-nubank) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.5rem !important;
  margin: 1rem 0 !important;
  color: var(--text-primary) !important;
  box-shadow: 0 4px 20px var(--shadow-color) !important;
}

.nubank-mode-indicator h4 {
  color: var(--text-primary) !important;
  font-weight: 700 !important;
  margin-bottom: 0.5rem !important;
}

.establishment-card {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--border-color) !important;
  border-radius: var(--border-radius) !important;
  padding: 1.2rem !important;
  margin: 0.8rem 0 !important;
  transition: var(--transition-normal) !important;
  box-shadow: 0 4px 16px var(--shadow-color) !important;
  color: var(--text-primary) !important;
}

.establishment-card:hover {
  border-color: var(--accent-nubank) !important;
  transform: translateY(-2px) !important;
  box-shadow: 0 8px 24px var(--shadow-hover) !important;
}

/* ============= SCROLLBAR PERSONALIZADA ============= */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--accent-blue);
  border-radius: 4px;
  transition: var(--transition-fast);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-purple);
}

/* ============= RESPONSIVIDADE ============= */
@media (max-width: 768px) {
  .main-header {
    padding: 1.5rem 1rem !important;
    margin-bottom: 1.5rem !important;
  }
  
  .main-header h1 {
    font-size: 2rem !important;
  }
  
  [data-testid="metric-container"] {
    padding: 1rem !important;
    margin: 0.5rem 0 !important;
  }
  
  .stButton > button {
    padding: 0.6rem 1.5rem !important;
    font-size: 0.9rem !important;
  }
  
  .nav-menu {
    margin: 0.5rem 0 !important;
    padding: 0.8rem !important;
  }
}

/* ============= UTILITÁRIOS DE COR ============= */
.text-primary { color: var(--text-primary) !important; }
.text-secondary { color: var(--text-secondary) !important; }
.text-muted { color: var(--text-muted) !important; }
.text-success { color: var(--accent-green) !important; }
.text-danger { color: var(--accent-red) !important; }
.text-warning { color: var(--accent-orange) !important; }
.text-info { color: var(--accent-blue) !important; }
.text-nubank { color: var(--accent-nubank) !important; }

.bg-primary { background-color: var(--bg-primary) !important; }
.bg-secondary { background-color: var(--bg-secondary) !important; }
.bg-tertiary { background-color: var(--bg-tertiary) !important; }

/* ============= ANIMAÇÕES SUAVES ============= */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-fade-in {
  animation: fadeInUp 0.6s ease-out !important;
}

.animate-slide-in {
  animation: slideInRight 0.5s ease-out !important;
}

/* ============= GARANTIA DE VISIBILIDADE TOTAL ============= */
/* Override para qualquer elemento que possa ter cor fixa */
.stApp * {
  transition: color 0.3s ease, background-color 0.3s ease !important;
}

/* Garantir que markdown seja sempre legível */
.stMarkdown p, .stMarkdown div, .stMarkdown span,
.stMarkdown h1, .stMarkdown h2, .stMarkdown h3,
.stMarkdown h4, .stMarkdown h5, .stMarkdown h6,
.stMarkdown li, .stMarkdown ul, .stMarkdown ol {
  color: var(--text-primary) !important;
  background-color: transparent !important;
}

/* Links sempre visíveis */
.stMarkdown a, a {
  color: var(--accent-blue) !important;
  text-decoration: underline !important;
}

.stMarkdown a:hover, a:hover {
  color: var(--accent-purple) !important;
}

/* Códigos sempre legíveis */
.stMarkdown code, code,
.stMarkdown pre, pre {
  background: var(--bg-tertiary) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 4px !important;
  padding: 0.2rem 0.4rem !important;
}